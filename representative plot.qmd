---
title: "representative plot"
author: "NA"
format: pdf
editor: visual
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(patchwork)
library(ggforce) 


metric_colors <- c(
  "Structural Size" = "#1b9e77",
  "Density" = "#7570b3",  
  "Composition" = "#e7298a"  
)

plot_empirical_and_ratchet_fixed <- function() {
  
  empirical_raw <- tibble::tribble(
    ~Metric,           ~Edge,   ~Transition, ~Interior,
    "Structural Size",  11.8,     14.8,        15.8,
    "Density",          33.6,     43.4,        28.4,
    "Composition",      0.30,     0.15,        0.00
  )

  empirical_df <- empirical_raw |>
    pivot_longer(-Metric, names_to="Zone", values_to="Value") |>
    group_by(Metric) |>
    mutate(Relative = (Value - min(Value)) / (max(Value) - min(Value))) |>
    ungroup() |>
    mutate(Zone = factor(Zone, levels=c("Edge","Transition","Interior")))

 p_emp <- ggplot(empirical_df, aes(x=Zone, y=Relative, color=Metric, group=Metric)) +
    geom_line(size=1.3) +
    geom_point(size=3) +
    scale_color_manual(values=metric_colors) +
    labs(title="",
      x="Spatial Zone (Edge → Interior)",
      y="Relative Value (0–1)"
    ) + guides(color = guide_legend(title = NULL)) + 
    theme_bw(base_size=14) +
    theme(legend.position = "bottom",     
      plot.title = element_text(face="bold", hjust=0.5))

    x <- seq(0, 1, length.out=100)
  ratchet_df <- data.frame(
    Position = x,
    Structural_Size = 1.0 - 0.9 * (1 - x)^2,
    Density = 1.0 - 0.6 * (1 - x)^1.5,
    Composition = 1.0 - 0.8 * (1 - x)^1.1
  ) |>
    rename(`Structural Size` = Structural_Size) |>  
    pivot_longer(-Position, names_to="Metric", values_to="Value")

  p_ratchet <- ggplot(ratchet_df, aes(x=Position, y=Value, color=Metric)) +
    geom_line(size=1.3) +
    scale_color_manual(values=metric_colors) +
    labs(title="",
      x="Gradient (Edge → Interior)",
      y="Relative Value (0–1)"
    ) + guides(color = guide_legend(title = NULL)) + 
    theme_bw(base_size=14) +
    theme( legend.position = "bottom",
      plot.title = element_text(face="bold", hjust=0.5))

  list(empirical_plot=p_emp, ratchet_plot=p_ratchet)
}

plots <- plot_empirical_and_ratchet_fixed()

plots$ratchet_plot 
plots$empirical_plot
```

```{r}
library(ggplot2)
library(dplyr)
library(ggforce)

set.seed(42)

make_patch <- function(center_x, center_y, radius,
                       n_trees, size_mean, size_sd,
                       p_edge, upland_col, edge_col) {
  tibble(
    angle = runif(n_trees, 0, 2*pi),
    r     = sqrt(runif(n_trees, 0, 1)) * radius,
    size  = pmax(rnorm(n_trees, size_mean, size_sd), 1),
    Composition = ifelse(runif(n_trees) < p_edge, edge_col, upland_col)
  ) |>
    mutate(
      x = center_x + r * cos(angle),
      y = center_y + r * sin(angle)
    )
}

upland_col <- "#009E73" 
edge_col   <- "#D55E00"  

dens_edge_con  <- 12
dens_tran_con  <- 24
dens_int_con   <- 40

size_edge_con <- 3
size_tran_con <- 6
size_int_con  <- 9

p_edge_edge_con  <- 0.95 
p_edge_tran_con  <- 0.50 
p_edge_int_con   <- 0.05 

patch_edge_con <- make_patch(1, 0, 1,
                             dens_edge_con, size_edge_con, 0.8,
                             p_edge_edge_con, upland_col, edge_col)

patch_tran_con <- make_patch(4, 0, 1,
                             dens_tran_con, size_tran_con, 1.0,
                             p_edge_tran_con, upland_col, edge_col)

patch_int_con <- make_patch(7, 0, 1,
                            dens_int_con, size_int_con, 1.2,
                            p_edge_int_con, upland_col, edge_col)

all_ratchet <- bind_rows(
  patch_edge_con  |> mutate(Zone = "Edge",       cx = 1, cy = 0),
  patch_tran_con  |> mutate(Zone = "Transition", cx = 4, cy = 0),
  patch_int_con   |> mutate(Zone = "Interior",   cx = 7, cy = 0)
)

circle_df <- tibble(
  Zone = c("Edge","Transition","Interior"),
  cx   = c(1,4,7),
  cy   = 0,
  r    = 1
)

p_ratchet <- ggplot() +
  geom_circle(data = circle_df,
              aes(x0 = cx, y0 = cy, r = r),
              size = 1.2, color = "black", fill = NA) +
  geom_point(data = all_ratchet,
             aes(x = x, y = y, fill = Composition, size = size),
             shape = 21, color = "black", alpha = 0.95) +
  geom_text(data = circle_df,
            aes(x = cx, y = cy + 1.35, label = Zone),
            fontface = "bold", size = 6) +
  scale_fill_identity(
    guide  = "legend",
    breaks = c(upland_col, edge_col),
    labels = c("Upland Species", "Edge-Tolerant Species")
  ) +
  scale_size_continuous(range = c(3, 12), guide = "none") +
  coord_equal() +
  labs(title = "",
       subtitle = "",
       fill = "Composition") +
  theme_void(base_size = 14) +
  theme(
    legend.position = "bottom",
    legend.title    = element_text(face = "bold")
  )

p_ratchet 
```

```{r}
library(ggplot2)
library(dplyr)
library(ggforce)

set.seed(42)

patch_emp <- function(center_x, center_y, radius,
                           n_trees, size_mean, size_sd,
                           p_edge, upland_col, edge_col) {
  tibble(
    angle = runif(n_trees, 0, 2*pi),
    r     = sqrt(runif(n_trees, 0, 1)) * radius,
    size  = pmax(rnorm(n_trees, size_mean, size_sd), 1),
    Composition = ifelse(runif(n_trees) < p_edge, edge_col, upland_col)
  ) |>
    mutate(
      x = center_x + r * cos(angle),
      y = center_y + r * sin(angle)
    )
}

upland_col <- "#009E73"
edge_col   <- "#D55E00"


max_trees  <- 40  
edge_n_emp  <- round(max_trees * (109/131))  
tran_n_emp  <- round(max_trees * 1.0)     
int_n_emp   <- round(max_trees * (91/131))

p_edge_edge_emp  <- 61/109   
p_edge_tran_emp  <- 60/131 
p_edge_int_emp   <- 12/91    

size_edge <- 11.8
size_tran <- 14.8
size_int  <- 15.8

scale_size <- function(x) (x - min(x)) / (max(x) - min(x)) * 6 + 4
size_scaled <- scale_size(c(size_edge, size_tran, size_int))

patch_edge_emp <- patch_emp(1, 0, 1,
                                 edge_n_emp, size_scaled[1], 1.0,
                                 p_edge_edge_emp, upland_col, edge_col)

patch_tran_emp <- patch_emp(4, 0, 1,
                                 tran_n_emp, size_scaled[2], 1.1,
                                 p_edge_tran_emp, upland_col, edge_col)

patch_int_emp <- patch_emp(7, 0, 1,
                                int_n_emp, size_scaled[3], 1.2,
                                p_edge_int_emp, upland_col, edge_col)

all_emp <- bind_rows(
  patch_edge_emp |> mutate(Zone = "Edge",       cx = 1, cy = 0),
  patch_tran_emp |> mutate(Zone = "Transition", cx = 4, cy = 0),
  patch_int_emp  |> mutate(Zone = "Interior",   cx = 7, cy = 0)
)

circle_df <- tibble(
  Zone = c("Edge","Transition","Interior"),
  cx   = c(1,4,7),
  cy   = 0,
  r    = 1
)

p_empirical <- ggplot() +
  geom_circle(data = circle_df,
              aes(x0 = cx, y0 = cy, r = r),
              size = 1.2, color = "black", fill = NA) +
  geom_point(data = all_emp,
             aes(x = x, y = y, fill = Composition, size = size),
             shape = 21, color = "black", alpha = 0.95) +
  geom_text(data = circle_df,
            aes(x = cx, y = cy + 1.35, label = Zone),
            fontface = "bold", size = 6) +
  scale_fill_identity(
    guide  = "legend",
    breaks = c(upland_col, edge_col),
    labels = c("Upland Species", "Edge-Tolerant Species")
  ) +
  scale_size_continuous(range = c(3, 12), guide = "none") +
  coord_equal() +
  labs(title = "",
       subtitle = "",
       fill = "Composition") +
  theme_void(base_size = 14) +
  theme(
    legend.position = "bottom",
    legend.title    = element_text(face = "bold")
  )

p_empirical
```
